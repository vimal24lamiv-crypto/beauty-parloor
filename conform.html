<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tharana | Booking Confirmed</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-[#fdf8f8] p-4 md:p-8">

    <div id="undoToast" class="fixed bottom-10 left-1/2 -translate-x-1/2 z-[100] hidden w-full max-w-md">
        <div class="bg-gray-900 text-white p-4 rounded-2xl shadow-2xl flex items-center justify-between relative overflow-hidden">
            <span>Record deleted</span>
            <button onclick="undoDelete()" class="text-rose-400 font-bold text-xs uppercase">Undo</button>
            <div class="absolute bottom-0 left-0 h-1 bg-rose-500 w-full" style="animation: progress 60s linear forwards;"></div>
        </div>
    </div>

    <div class="max-w-5xl mx-auto space-y-8">
        <div class="bg-white rounded-[2rem] shadow-2xl border border-rose-50 overflow-hidden">
            <div class="bg-rose-900 py-6 text-center text-white">
                <h1 class="font-serif text-2xl">Booking Confirmed!</h1>
                <p id="realTimeLog" class="text-[10px] tracking-widest opacity-80 uppercase mt-1"></p>
            </div>
            <div class="p-8">
                <div id="latestDisplay" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-6 text-center">
                    </div>
            </div>
        </div>

        <div class="bg-white rounded-[2rem] p-6 md:p-10 shadow-lg border border-rose-100">
            <div class="flex justify-between items-center mb-8">
                <h2 class="font-serif text-xl text-rose-900">All Appointments</h2>
                <button onclick="clearHistory()" class="text-[10px] text-rose-400 border border-rose-100 px-4 py-2 rounded-full uppercase">Clear All</button>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full text-left text-sm">
                    <thead>
                        <tr class="text-rose-400 border-b border-rose-50 uppercase text-[10px] tracking-widest">
                            <th class="pb-4">Booking Log</th>
                            <th class="pb-4">Client Info</th>
                            <th class="pb-4">Service</th>
                            <th class="pb-4">Price</th>
                            <th class="pb-4 text-right">Delete</th>
                        </tr>
                    </thead>
                    <tbody id="historyTable" class="text-gray-600"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        function init() {
            const latest = JSON.parse(localStorage.getItem('latestBooking'));
            if(latest) {
                document.getElementById('realTimeLog').innerText = `System Logged At: ${latest.bookedAt}`;
                document.getElementById('latestDisplay').innerHTML = `
                    <div><p class="text-[9px] text-rose-400 font-bold uppercase">Name</p><p class="font-bold text-rose-900">${latest.name}</p></div>
                    <div><p class="text-[9px] text-rose-400 font-bold uppercase">Phone</p><p class="font-bold text-rose-900">${latest.phone}</p></div>
                    <div><p class="text-[9px] text-rose-400 font-bold uppercase">Service</p><p class="font-bold text-rose-900">${latest.service}</p></div>
                    <div><p class="text-[9px] text-rose-400 font-bold uppercase">Price</p><p class="font-bold text-rose-900">${latest.price}</p></div>
                    <div><p class="text-[9px] text-rose-400 font-bold uppercase">Appt Date</p><p class="font-bold text-rose-900">${latest.date}</p></div>
                    <div><p class="text-[9px] text-rose-400 font-bold uppercase">Appt Time</p><p class="font-bold text-rose-900">${latest.time}</p></div>
                `;
            }
            loadHistory();
        }

        function loadHistory() {
            const all = JSON.parse(localStorage.getItem('parlourHistory')) || [];
            const table = document.getElementById('historyTable');
            table.innerHTML = all.slice().reverse().map((item, index) => {
                const actualIdx = all.length - 1 - index;
                return `
                    <tr class="border-b border-rose-50 hover:bg-rose-50/50">
                        <td class="py-5">
                            <span class="block text-xs font-bold text-rose-800">${item.bookedAt}</span>
                            <span class="text-[9px] text-gray-400 uppercase">Real Time Save</span>
                        </td>
                        <td class="py-5">
                            <span class="block font-bold">${item.name}</span>
                            <span class="text-[10px] text-gray-500">${item.phone}</span>
                        </td>
                        <td class="py-5">
                            <span class="block">${item.service}</span>
                            <span class="text-[10px] text-gray-400">${item.date} @ ${item.time}</span>
                        </td>
                        <td class="py-5 font-bold text-rose-600">${item.price}</td>
                        <td class="py-5 text-right">
                            <button onclick="deleteRow(${actualIdx})" class="text-rose-200 hover:text-rose-600"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function deleteRow(idx) {
            let all = JSON.parse(localStorage.getItem('parlourHistory'));
            all.splice(idx, 1);
            localStorage.setItem('parlourHistory', JSON.stringify(all));
            loadHistory();
        }

        function clearHistory() {
            if(confirm("Delete all records?")) {
                localStorage.clear();
                location.reload();
            }
        }

        window.onload = init;
    </script>
</body>
</html>